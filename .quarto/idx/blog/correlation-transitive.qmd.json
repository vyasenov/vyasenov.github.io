{"title":"Correlation is Not (Always) Transitive","markdown":{"yaml":{"title":"Correlation is Not (Always) Transitive","date":"2022-12-22","categories":["correlation","statistical inference"]},"headingText":"Background","containsRefs":false,"markdown":"\n\n\nAt first, I found this really puzzling. $X$ is correlated (Pearson) with Y, and Y is correlated with $Z$. Does this mean X is necessarily correlated with $Z$? Intuitively, this totally makes sense. The answer, however, is “no.”\n\nPerhaps the strangest thing is how easy it is to rationalize this “puzzle.” I drink more beer ($X$) and read more books ($Z$) when I am on a vacation (Y). That is, both pairs – $X$ and $Y$ and $Z$ and $Y$ – are positively correlated. But I do not drink more beer when I read more books – $X$ and $Z$ are not correlated. It is now obvious that correlation is not (always) transitive, but a second ago, this sounded bizarre.\n\n## A Closer Look\n\nLet’s denote the respective correlations between $X$, $Y$ and $Z$ by $cor(X,Y)$, $cor(X,Z)$, and $cor(Y,Z)$. For simplicity (and without loss of generality), let’s work with standardized versions of these variables – that is, means of $0$ and variances of $1$. This implies, $cov(X,Y) = cor(X,Y)$ for any pair.\n\nWe can write the linear projections of $X$ and $Z$ on $Y$ as follows:\n\n$$ X = cor(X,Y)Y + \\epsilon^{X,Y}, $$\n\n$$ Z = cor(Z,Y)Y + \\epsilon^{Z,Y}. $$\n\nThen, we have:\n\n$$ cor(X,Z)=cor(X,Y)cor(Z,Y)+cor(\\epsilon^{X,Y},\\epsilon^{Z,Y}).$$\n\nWe can use the Cauchy-Schwarz inequality to bound the last term, which gives the final range of possible values for cor(X,Z):\n\n$$cor(X,Y)cor(Z,Y) - \\sqrt{(1-cor(X,Y)^2) (1-cor(Z,Y)^2)}$$\n\n$$\\leq cor(X,Z) \\leq  $$\n\n$$cor(X,Y)cor(Z,Y) + \\sqrt{(1-cor(X,Y)^2) (1-cor(Z,Y)^2)}$$\n\nFor instance, if we set $cor(X,Y)=cor(Z,Y)=0.6$, then we get:\n\n$$-.28 \\leq cor(X,Z) \\leq 1.$$\n\nThat is, $cor(X,Z)$ can be negative.\n\n### Examples\n\n### Example: City Lifestyle\n\nLet's go through three examples of non-transitive correlations.\n\nLet $X$ represent the number of hours a person spends commuting daily in a city, $Y$ represent their monthly public transit expenses, and $Z$ represent their daily step count. $X$ and $Y$ are correlated because longer commutes ($X$) typically involve more frequent or longer public transit use, increasing transit expenses ($Y$). Similarly, $X$ and $Z$ are correlated since longer commutes ($X$) often involve more walking to and from transit stops, boosting step count ($Z$). However, $Y$ and $Z$ are not correlated because transit expenses ($Y$) depend on fare structures and trip frequency, while step count ($Z$) is influenced by walking habits unrelated to cost, such as choosing to walk shorter distances or using different transit routes, resulting in no direct relationship between the two.\n\nConsider $X$ as the number of hours a person exercises per week, $Y$ as their muscle mass, and $Z$ as their resting heart rate. $X$ and $Y$ are correlated because more exercise ($X$) typically increases muscle mass ($Y$). Likewise, $X$ and $Z$ are correlated since regular exercise ($X$) tends to lower resting heart rate ($Z$). However, $Y$ and $Z$ are not correlated because muscle mass ($Y$) and resting heart rate ($Z$) are influenced by different physiological mechanisms—muscle mass depends on strength training, while heart rate is more tied to cardiovascular fitness—and thus show no direct relationship.\n\nPerhaps the simplest example to illustrate this mathematically is:\n\n- $X$ and $Z$ are independent random variables,\n- $Y=X+Z$.\nThe result follows.\n\nThe following code sets up this example in `R` and `python`.\n\n:::: {.panel-tabset}\n\n### R\n```r\nrm(list=ls())\nset.seed(68493)\n\nx <- runif(n=1000)\nz <- runif(n=1000)\ny <- x + z\n\ncor(y, x)\ncor(y, z)\ncor(z, x)\n\ncor.test(y, x, alternative='two.sided', method='pearson')\ncor.test(y, z, alternative='two.sided', method='pearson')\ncor.test(z, x, alternative='two.sided', method='pearson')\n```\n\n### Python\n```python\nimport numpy as np\nfrom scipy.stats import pearsonr\n\n# Set seed for reproducibility\nnp.random.seed(68493)\n\n# Generate random variables\nx = np.random.uniform(size=1000)\nz = np.random.uniform(size=1000)\ny = x + z\n\n# Compute correlations\nprint(\"cor(y, x):\", np.corrcoef(y, x)[0, 1])\nprint(\"cor(y, z):\", np.corrcoef(y, z)[0, 1])\nprint(\"cor(z, x):\", np.corrcoef(z, x)[0, 1])\n\n# Perform correlation tests\nprint(\"cor.test(y, x):\", pearsonr(y, x))\nprint(\"cor.test(y, z):\", pearsonr(y, z))\nprint(\"cor.test(z, x):\", pearsonr(z, x))\n```\n\n::::\n\nBelow is a table with correlation coefficients and $p$-values associated with the null hypotheses that they are equal to zero.\n\n<div style=\"max-width: 400px; margin: 0 auto;\">\nvars | cor. coef. | $p$-value\n|-----|:-----|:-----\n$cor(X,Y)$ | 0.68 | 0.00\n$cor(Z,Y)$ | 0.70 | 0.00\n$cor(X,Z)$ |-0.05 | 0.15\n</div>\n\n## When *Is* Correlation Transitive\n\nFrom the equation above it follows that when both $cor(X,Y)$ and $cor(Z,Y)$ are sufficiently large, then $cor(X,Z)$ is sure to be positive (i.e., bounded below by $0$).\n\nIn the example above, if we fix $cor(X,Y)=.6$, then we need $cor(Z,Y)>.8$ to guarantee that $cor(X,Z)>0$.\n\n## Where to Learn More\n\nMultiple Stack Overflow threads explain this phenomenon from various angles. Olkin (1981) derives some further mathematical results related to transitivity in higher dimensions.\n\n## Bottom Line\n\n- $X$ and $Z$ both being correlated with $Y$ does not guarantee that $X$ and $Z$ are correlated with each other.\n\n- This is the case when the former two correlations are “large enough.”\n\n## References\n\nOlkin, I. (1981). Range restrictions for product-moment correlation matrices. Psychometrika, 46, 469-472. doi:10.1007/BF02293804","srcMarkdownNoYaml":"\n\n## Background\n\nAt first, I found this really puzzling. $X$ is correlated (Pearson) with Y, and Y is correlated with $Z$. Does this mean X is necessarily correlated with $Z$? Intuitively, this totally makes sense. The answer, however, is “no.”\n\nPerhaps the strangest thing is how easy it is to rationalize this “puzzle.” I drink more beer ($X$) and read more books ($Z$) when I am on a vacation (Y). That is, both pairs – $X$ and $Y$ and $Z$ and $Y$ – are positively correlated. But I do not drink more beer when I read more books – $X$ and $Z$ are not correlated. It is now obvious that correlation is not (always) transitive, but a second ago, this sounded bizarre.\n\n## A Closer Look\n\nLet’s denote the respective correlations between $X$, $Y$ and $Z$ by $cor(X,Y)$, $cor(X,Z)$, and $cor(Y,Z)$. For simplicity (and without loss of generality), let’s work with standardized versions of these variables – that is, means of $0$ and variances of $1$. This implies, $cov(X,Y) = cor(X,Y)$ for any pair.\n\nWe can write the linear projections of $X$ and $Z$ on $Y$ as follows:\n\n$$ X = cor(X,Y)Y + \\epsilon^{X,Y}, $$\n\n$$ Z = cor(Z,Y)Y + \\epsilon^{Z,Y}. $$\n\nThen, we have:\n\n$$ cor(X,Z)=cor(X,Y)cor(Z,Y)+cor(\\epsilon^{X,Y},\\epsilon^{Z,Y}).$$\n\nWe can use the Cauchy-Schwarz inequality to bound the last term, which gives the final range of possible values for cor(X,Z):\n\n$$cor(X,Y)cor(Z,Y) - \\sqrt{(1-cor(X,Y)^2) (1-cor(Z,Y)^2)}$$\n\n$$\\leq cor(X,Z) \\leq  $$\n\n$$cor(X,Y)cor(Z,Y) + \\sqrt{(1-cor(X,Y)^2) (1-cor(Z,Y)^2)}$$\n\nFor instance, if we set $cor(X,Y)=cor(Z,Y)=0.6$, then we get:\n\n$$-.28 \\leq cor(X,Z) \\leq 1.$$\n\nThat is, $cor(X,Z)$ can be negative.\n\n### Examples\n\n### Example: City Lifestyle\n\nLet's go through three examples of non-transitive correlations.\n\nLet $X$ represent the number of hours a person spends commuting daily in a city, $Y$ represent their monthly public transit expenses, and $Z$ represent their daily step count. $X$ and $Y$ are correlated because longer commutes ($X$) typically involve more frequent or longer public transit use, increasing transit expenses ($Y$). Similarly, $X$ and $Z$ are correlated since longer commutes ($X$) often involve more walking to and from transit stops, boosting step count ($Z$). However, $Y$ and $Z$ are not correlated because transit expenses ($Y$) depend on fare structures and trip frequency, while step count ($Z$) is influenced by walking habits unrelated to cost, such as choosing to walk shorter distances or using different transit routes, resulting in no direct relationship between the two.\n\nConsider $X$ as the number of hours a person exercises per week, $Y$ as their muscle mass, and $Z$ as their resting heart rate. $X$ and $Y$ are correlated because more exercise ($X$) typically increases muscle mass ($Y$). Likewise, $X$ and $Z$ are correlated since regular exercise ($X$) tends to lower resting heart rate ($Z$). However, $Y$ and $Z$ are not correlated because muscle mass ($Y$) and resting heart rate ($Z$) are influenced by different physiological mechanisms—muscle mass depends on strength training, while heart rate is more tied to cardiovascular fitness—and thus show no direct relationship.\n\nPerhaps the simplest example to illustrate this mathematically is:\n\n- $X$ and $Z$ are independent random variables,\n- $Y=X+Z$.\nThe result follows.\n\nThe following code sets up this example in `R` and `python`.\n\n:::: {.panel-tabset}\n\n### R\n```r\nrm(list=ls())\nset.seed(68493)\n\nx <- runif(n=1000)\nz <- runif(n=1000)\ny <- x + z\n\ncor(y, x)\ncor(y, z)\ncor(z, x)\n\ncor.test(y, x, alternative='two.sided', method='pearson')\ncor.test(y, z, alternative='two.sided', method='pearson')\ncor.test(z, x, alternative='two.sided', method='pearson')\n```\n\n### Python\n```python\nimport numpy as np\nfrom scipy.stats import pearsonr\n\n# Set seed for reproducibility\nnp.random.seed(68493)\n\n# Generate random variables\nx = np.random.uniform(size=1000)\nz = np.random.uniform(size=1000)\ny = x + z\n\n# Compute correlations\nprint(\"cor(y, x):\", np.corrcoef(y, x)[0, 1])\nprint(\"cor(y, z):\", np.corrcoef(y, z)[0, 1])\nprint(\"cor(z, x):\", np.corrcoef(z, x)[0, 1])\n\n# Perform correlation tests\nprint(\"cor.test(y, x):\", pearsonr(y, x))\nprint(\"cor.test(y, z):\", pearsonr(y, z))\nprint(\"cor.test(z, x):\", pearsonr(z, x))\n```\n\n::::\n\nBelow is a table with correlation coefficients and $p$-values associated with the null hypotheses that they are equal to zero.\n\n<div style=\"max-width: 400px; margin: 0 auto;\">\nvars | cor. coef. | $p$-value\n|-----|:-----|:-----\n$cor(X,Y)$ | 0.68 | 0.00\n$cor(Z,Y)$ | 0.70 | 0.00\n$cor(X,Z)$ |-0.05 | 0.15\n</div>\n\n## When *Is* Correlation Transitive\n\nFrom the equation above it follows that when both $cor(X,Y)$ and $cor(Z,Y)$ are sufficiently large, then $cor(X,Z)$ is sure to be positive (i.e., bounded below by $0$).\n\nIn the example above, if we fix $cor(X,Y)=.6$, then we need $cor(Z,Y)>.8$ to guarantee that $cor(X,Z)>0$.\n\n## Where to Learn More\n\nMultiple Stack Overflow threads explain this phenomenon from various angles. Olkin (1981) derives some further mathematical results related to transitivity in higher dimensions.\n\n## Bottom Line\n\n- $X$ and $Z$ both being correlated with $Y$ does not guarantee that $X$ and $Z$ are correlated with each other.\n\n- This is the case when the former two correlations are “large enough.”\n\n## References\n\nOlkin, I. (1981). Range restrictions for product-moment correlation matrices. Psychometrika, 46, 469-472. doi:10.1007/BF02293804"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../code/styles.css"],"toc":true,"include-in-header":[{"text":"<script src=\"../code/open-links-new-tab.js\"></script>\n"}],"filters":["code-insertion"],"output-file":"correlation-transitive.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.24","resources":["../code/open-links-new-tab.js"],"theme":{"light":"cosmo","dark":"cyborg"},"header-includes":["<script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=680ee8d89f7a510019a96bcf&product=inline-share-buttons' async='async'></script>"],"page-layout":"full","includes":{"after-body":["../_includes/comments.html"]},"insert-before-post":"_sharebuttons.md","title":"Correlation is Not (Always) Transitive","date":"2022-12-22","categories":["correlation","statistical inference"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}