<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-10-22">

<title>Multiple Testing: Methods Overview (Part 1) – Vasco Yasenov</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-1e438c382a17f6d88d3993662a872df6.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-a37c72dd2dbac68997fcdc15a3622e78.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-a9957ab5e8b7c67643b7e2e6b5c1e54e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    window.setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      window.setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    window.hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(darkModeDefault) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const darkModeDefault = false;
    document.querySelector('link.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !window.hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
    };
    // Switch to dark mode if need be
    if (window.hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Vasco Yasenov</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../cv.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../childrenbook.html"> 
<span class="menu-text">Children’s Book</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/vyasenov" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/vasil-yasenov/" target="_blank"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=pQw1oG8AAAAJ" target="_blank"> <i class="bi bi-mortarboard-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.amazon.com/Causal-Inference-Toddlers-Meatball-Recipe/dp/B0BLG6SWZJ" target="_blank"> <i class="bi bi-amazon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a></li>
  <li><a href="#notation" id="toc-notation" class="nav-link" data-scroll-target="#notation">Notation</a></li>
  <li><a href="#a-closer-look" id="toc-a-closer-look" class="nav-link" data-scroll-target="#a-closer-look">A Closer Look</a>
  <ul class="collapse">
  <li><a href="#when-is-mh-control-not-necessary" id="toc-when-is-mh-control-not-necessary" class="nav-link" data-scroll-target="#when-is-mh-control-not-necessary">When is MH Control NOT Necessary</a></li>
  <li><a href="#fwer-vs-fdr" id="toc-fwer-vs-fdr" class="nav-link" data-scroll-target="#fwer-vs-fdr">FWER vs FDR</a></li>
  <li><a href="#fwer-control" id="toc-fwer-control" class="nav-link" data-scroll-target="#fwer-control">FWER Control</a></li>
  <li><a href="#fdr-control" id="toc-fdr-control" class="nav-link" data-scroll-target="#fdr-control">FDR Control</a></li>
  </ul></li>
  <li><a href="#an-example" id="toc-an-example" class="nav-link" data-scroll-target="#an-example">An Example</a></li>
  <li><a href="#bottom-line" id="toc-bottom-line" class="nav-link" data-scroll-target="#bottom-line">Bottom Line</a></li>
  <li><a href="#where-to-learn-more" id="toc-where-to-learn-more" class="nav-link" data-scroll-target="#where-to-learn-more">Where to Learn More</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Multiple Testing: Methods Overview (Part 1)</h1>
  <div class="quarto-categories">
    <div class="quarto-category">multiple testing</div>
    <div class="quarto-category">statistical inference</div>
  </div>
  </div>



<div class="quarto-title-meta column-page-left">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 22, 2022</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>The abundance of data around us is a major factor making the data science field so attractive. It enables all kinds of impactful, interesting, or fun analyses. I admit this is what got me into statistics and causal inference in the first place. However, this luxury has downsides – it might require deeper methodological knowledge and attention.</p>
<p>If we are interested in measuring statistical significance, the standard frequentist framework relies on testing a single hypothesis on any given dataset. Once we start using the same data multiple times – i.e., testing several hypotheses at once – as we often do, we might have to make some additional adjustments.</p>
<p>In this article, I will walk you through the most popular multiple hypotheses (MH) testing corrections. Common examples of when these come to play include estimating the impact of several variables on a single outcome or estimating the effect of an intervention on several subgroups of users to mine for heterogeneous treatment effects. Both scenarios are ubiquitous in most data analysis projects.</p>
<p>To illustrate the problem, imagine we are testing seven hypotheses at the <span class="math inline">\(5\%\)</span> significance level. Then, the probability that we incorrectly reject at least one of these hypotheses is:</p>
<p><span class="math display">\[ 1 - (1-.05)^7 = .30. \]</span></p>
<p>That is, roughly one in three times, we will reach a wrong conclusion.</p>
<p>Vaguely speaking, MH adjustments can be viewed as inflating the calculated p-values and hence decreasing the probability that we reject any given hypothesis. In other words, we are accounting for using the data multiple times by making the definition of statistical significance more stringent.</p>
</section>
<section id="notation" class="level2">
<h2 class="anchored" data-anchor-id="notation">Notation</h2>
<p>We are interested in testing a bunch of m null hypotheses about a population parameter <span class="math inline">\(\beta\)</span>.</p>
<p>As a running example, you can think of <span class="math inline">\(\beta\)</span> as the causal impact of a new product feature on user engagement and <span class="math inline">\(m\)</span> as indexing some geographical regions such as cities. We are interested in whether the new feature is more impactful in some cities than others. We will denote these hypotheses with <span class="math inline">\(H_1, H_2, \dots, H_m\)</span> and refer to their associated p-values with <span class="math inline">\(p_1, p_2, \dots, p_m\)</span>.</p>
<p>We use <span class="math inline">\(\alpha\)</span> to denote the probability of a Type 1 error – rejecting a true null (i.e., a false positive). In technical jargon, we refer to <span class="math inline">\(\alpha\)</span> as test size. We often choose <span class="math inline">\(\alpha=.05\)</span>, meaning that we are allowing a 5% chance that we will make such an error. This corresponds to the 95% confidence intervals that we often see.</p>
<p>Next, statistical power is the probability of correctly rejecting a false null hypothesis (i.e., a true positive). This is a desirable property – the higher it is, the better. While this terminology does not describe the entire hypothesis testing framework, it does cover what is necessary to continue reading the article.</p>
</section>
<section id="a-closer-look" class="level2">
<h2 class="anchored" data-anchor-id="a-closer-look">A Closer Look</h2>
<section id="when-is-mh-control-not-necessary" class="level3">
<h3 class="anchored" data-anchor-id="when-is-mh-control-not-necessary">When is MH Control NOT Necessary</h3>
<p>Multiple hypothesis adjustments are not required when:</p>
<ul>
<li>we are interested in a purely predictive model, such as in machine learning settings,</li>
<li>we have an independent dataset for each correlated hypothesis,</li>
<li>the dependent variables we are testing are not correlated. An example is testing the impact of a new feature or intervention on a set of outcomes unrelated to each other – e.g., health and education variables. In such cases, it is common to adjust for MH separately within the health- and education-related hypotheses.</li>
</ul>
<p>Before we dive into the methods, let’s establish some basic terminology and notation.</p>
</section>
<section id="fwer-vs-fdr" class="level3">
<h3 class="anchored" data-anchor-id="fwer-vs-fdr">FWER vs FDR</h3>
<p>There are two distinct types of targets that data scientists are after. The first one was introduced in the 1950s by the famous statistician John Tukey and is called Familywise Error Rate (FWER). FWER is the probability of making at least one type 1 error:</p>
<p><span class="math display">\[ FWER = \mathbb{P} (\text{At Least 1 Type 1 Error}). \]</span></p>
<p>In the example from the introduction, <span class="math inline">\(FWER = 0.3\)</span>.</p>
<p>Controlling the FWER is good, but sometimes it is not great. It does what it is supposed to do – limit the number of false positives, but it is often too conservative. In practice, too few variables remain significant after such FWER adjustments, especially when testing many (as opposed to just a few) hypotheses.</p>
<p>To correct this, in the 1990s, Yoav Benjamini and Yosef Hochberg, conceptualized controlling the so-called False Discovery Rate (FDR). FDR is the expected proportion of false positives:</p>
<p><span class="math display">\[ FDR = \mathbb{E} \left[ \frac{\text{\# False Positives}}{\text{\# False Positives + \# True Positives} } \right]. \]</span></p>
<p>Take a minute to notice the significant difference between these two approaches. FWER controls the probability of having at least one false positive at <span class="math inline">\(\alpha\)</span>. At the same time, FDR is okay with having several false positives as long as they are (on average) less than <span class="math inline">\(\alpha\)</span> of all hypotheses.</p>
<p>FWER is more conservative than FDR, resulting in fewer significant variables. In our example, applying an FWER adjustment as opposed to an FDR one will lead to fewer statistically significant differences in the impact of the new feature across various cities.</p>
<p>Let’s go over the most popular ways to control the FWER.</p>
</section>
<section id="fwer-control" class="level3">
<h3 class="anchored" data-anchor-id="fwer-control">FWER Control</h3>
<section id="bonferronis-procedure" class="level4">
<h4 class="anchored" data-anchor-id="bonferronis-procedure">Bonferroni’s Procedure</h4>
<p>You might have heard of this one. The procedure is extremely simple – it goes like this:</p>
<ol type="1">
<li>reject <span class="math inline">\(H_i\)</span> if <span class="math inline">\(p_i \times m  \leq \alpha\)</span> for all <span class="math inline">\(i\)</span>.</li>
</ol>
<p>In words, we multiply all <span class="math inline">\(p\)</span>-values by m and reject the hypotheses with adjusted <span class="math inline">\(p\)</span>-values that are smaller than or equal to <span class="math inline">\(\alpha\)</span>.</p>
<p>The Bonferroni adjustment is often considered to control the FWER, but it actually controls an even more conservative target – the per-family error rate (PFER). PFER is the sum of probabilities of Type 1 error for all the hypotheses.</p>
<p>You correctly guessed that PFER is considered too strict. Although it is common in practice, there are better alternatives. While the Bonferroni correction is simple and elegant, it is always dominated by the Holm-Bonferroni procedure, so there is really no reason ever to use it.</p>
</section>
<section id="holm-bonferronis-procedure" class="level4">
<h4 class="anchored" data-anchor-id="holm-bonferronis-procedure">Holm &amp; Bonferroni’s Procedure</h4>
<p>This adjustment offers greater statistical power than the Bonferroni method regardless of the test size without significantly compromising on simplicity. In algorithmic language:</p>
<ol type="1">
<li>Order the <span class="math inline">\(p\)</span>-values in ascending order – <span class="math inline">\(p_1, p_2, \dots, p_m.\)</span></li>
<li>Reject the null hypothesis <span class="math inline">\(H_1,\dots H_{k-1}\)</span>, where <span class="math inline">\(k\)</span> is the smallest index for which <span class="math inline">\(p_i \times (m+1-k) \leq \alpha\)</span>. Much like the Bonferroni method with a multiplication factor of (<span class="math inline">\(m+1-k\)</span>) instead of <span class="math inline">\(m\)</span>.</li>
</ol>
<p>These two procedures control the FWER by assuming a kind of a ‘worst-case’ scenario in which the <span class="math inline">\(p\)</span>-values are close to being independent of each other. To see why this is the case, imagine the extreme opposite scenario in which there is perfect positive dependence. Then, there is effectively one test statistic, and FWER adjustment is unnecessary.</p>
<p>In practice, however, the <span class="math inline">\(p\)</span>-values are often correlated, and exploiting this dependence can result in even more powerful FWER corrections. This can be achieved with various resampling methods, such as the bootstrap or permutation procedures.</p>
</section>
<section id="westfall-youngs-procedure" class="level4">
<h4 class="anchored" data-anchor-id="westfall-youngs-procedure">Westfall &amp; Young‘s Procedure</h4>
<p>The Westfall &amp; Young method, developed in the 1990s, was the first resampling procedure controlling the FWER. It uses the bootstrap to account for the dependence structure among the <span class="math inline">\(p\)</span>-values and improves on Holm-Bonferroni’s method.</p>
<p>It goes roughly like this:</p>
<ol type="1">
<li>Order the <span class="math inline">\(m\)</span> <span class="math inline">\(p\)</span>-values in ascending order – <span class="math inline">\(p_1, \dots, p_M\)</span>.</li>
<li>Begin with a <span class="math inline">\(COUNTER_i = 0\)</span> for each hypothesis <span class="math inline">\(i\)</span>.</li>
<li>Take a bootstrap sample and compute the <span class="math inline">\(m\)</span> <span class="math inline">\(p\)</span>-values (<span class="math inline">\(p^*_1, \dots, p^*_m\)</span>)</li>
<li>Define the successive minima by starting with the largest <span class="math inline">\(p\)</span>-value (<span class="math inline">\(\tilde{p}_M=p^*_M\)</span>) and for each subsequent hypothesis <span class="math inline">\(i\)</span> taking the minimum between <span class="math inline">\(\tilde{p}_{i+1}\)</span> and <span class="math inline">\(p^*_i\)</span>.</li>
</ol>
<ul>
<li>This gives a list of <span class="math inline">\(p\)</span>-values <span class="math inline">\(\tilde{p}_1, \dots, \tilde{p}_m\)</span>.</li>
</ul>
<ol start="5" type="1">
<li>If <span class="math inline">\(\tilde{p}_i \leq p_i\)</span> add 1 unit to <span class="math inline">\(COUNTER_i\)</span> for each <span class="math inline">\(i\)</span>.</li>
<li>Repeat steps 3-5 above <span class="math inline">\(B\)</span> times and compute the fraction <span class="math inline">\(\hat{p}_i = COUNT_i/B\)</span>.</li>
</ol>
<ul>
<li>This gives a list of <span class="math inline">\(p\)</span>-values <span class="math inline">\(\hat{p}_1, \dots, \hat{p}_m\)</span>.</li>
</ul>
<ol start="7" type="1">
<li>Enforce monotonicity by starting with <span class="math inline">\(\hat{p}_1\)</span> and for each subsequent hypothesis <span class="math inline">\(i\)</span> taking the maximum between <span class="math inline">\(\hat{p}_{i-1}\)</span> and <span class="math inline">\(\hat{p}_i\)</span>.</li>
</ol>
<ul>
<li>This final vector presents the FWER-adjusted <span class="math inline">\(p\)</span>-values.</li>
</ul>
<ol start="8" type="1">
<li>Reject all null hypotheses <span class="math inline">\(i\)</span> for which <span class="math inline">\(\hat{p}\leq \alpha\)</span>.</li>
</ol>
<p>Yes, this is a complicated procedure. But it does offer substantial improvements in power, especially if the hypotheses are positively correlated.</p>
<p>Importantly, Westfall and Young’s method rests on a critical assumption called “subset pivotality.” Roughly speaking, this condition requires that the joint distribution of any subset of test statistics does not depend on whether the remaining hypotheses are true or not.</p>
<p><em>Software Package</em>: <a href="https://www.rdocumentation.org/packages/multtest">multtest</a>.</p>
</section>
<section id="romano-wolfs-procedures" class="level4">
<h4 class="anchored" data-anchor-id="romano-wolfs-procedures">Romano &amp; Wolf‘s Procedure(s)</h4>
<p>This procedure improves on Westfall and Young’s method by not requiring a pivotality assumption. Here I am describing the method from Romano and Wolf’s 2005 Econometrica paper, although the authors have developed a few closely related FWER adjustments. This is the rough algorithm for it:</p>
<ol type="1">
<li>Order the test statistics in descending order, <span class="math inline">\(t_1 \geq t_2 \geq, \dots, t_m\)</span>.</li>
<li>Take B bootstrap samples, and for each hypothesis i compute the empirical distribution function of the successive maximum test statistic random variable.</li>
</ol>
<ul>
<li>That is, the random variable of the maximum test statistic between <span class="math inline">\(t_i, t_{i+1}, \dots, t_m\)</span>.</li>
<li>Call this distribution <span class="math inline">\(c(i)\)</span>.</li>
</ul>
<ol start="3" type="1">
<li>Reject <span class="math inline">\(H_i\)</span> if <span class="math inline">\(t_i\)</span> is greater than the 1-quantile of <span class="math inline">\(c(1)\)</span>.</li>
<li>Denote by h the number of rejected hypotheses. If <span class="math inline">\(h=0\)</span> stop. Otherwise, for <span class="math inline">\(H_{h+1},\dots H_s\)</span>:</li>
<li>Reject <span class="math inline">\(H_i\)</span> if <span class="math inline">\(t_i &gt; c(h+1)\)</span></li>
<li>Iterate until no further hypotheses are rejected.</li>
</ol>
<p>And you thought the Westfall and Young correction was tricky. The good news is that there are software packages for all these adjustments, so you won’t have to program them yourself. Arguably, this one of the best ways to control FWER; does not rest on pivotality assumptions. However, it can be difficult to explain to non-technical audiences; difficult to explain to anyone, really.</p>
<p><em>Software Package</em>: <a href="https://www.rdocumentation.org/packages/hdm">hdm</a>.</p>
<p>This wraps up the descriptions of the methods controlling the FWER.</p>
</section>
</section>
<section id="fdr-control" class="level3">
<h3 class="anchored" data-anchor-id="fdr-control">FDR Control</h3>
<p>As a reminder, FDR procedures have greater power at the cost of increased rates of type 1 errors compared to FWER adjustments. This is the dominant framework in the modern literature on MH adjustment.</p>
<section id="benjamini-hochbergs-procedure" class="level4">
<h4 class="anchored" data-anchor-id="benjamini-hochbergs-procedure">Benjamini &amp; Hochberg‘s Procedure</h4>
<p>The Benjamini-Hochberg (BH) method is simple:</p>
<ol type="1">
<li>Order the <span class="math inline">\(p\)</span>-values in ascending order – <span class="math inline">\(p_1, p_2, \dots, p_m\)</span>.</li>
<li>Find the largest integer <span class="math inline">\(k\)</span> such that <span class="math inline">\(p_k \times \frac{m}{k} \leq \alpha\)</span>.</li>
<li>Reject the null hypotheses <span class="math inline">\(H_1, \dots, H_k\)</span>.</li>
</ol>
<p>BH is valid when the tests are independent and in some, but not all, dependence scenarios. In general, FDR control is tricky with arbitrary dependence.</p>
<p>This adjustment has an interesting geometric interpretation:</p>
<ul>
<li>plot <span class="math inline">\(p\)</span> versus <span class="math inline">\(k\)</span>,</li>
<li>draw a line through the origin with a slope equal to <span class="math inline">\(frac{\alpha}{m}\)</span>,</li>
<li>reject all hypotheses associated with the <span class="math inline">\(p\)</span>-values on the left up to the last point below this line.</li>
</ul>
</section>
<section id="benjamini-yekutielis-procedure" class="level4">
<h4 class="anchored" data-anchor-id="benjamini-yekutielis-procedure">Benjamini &amp; Yekutieli‘s Procedure</h4>
<p>Benjamini and Yekutieli (BY) developed a refinement of the BH procedure, which adds a magical constant <span class="math inline">\(c(m)\)</span>:</p>
<ol type="1">
<li>Order the <span class="math inline">\(p\)</span>-values in ascending order – <span class="math inline">\(p_1, p_2, \dots, p_m\)</span>.</li>
<li>Find the largest integer <span class="math inline">\(k\)</span> such that <span class="math inline">\(p_k \times \frac{m.c(m)}{k}\leq \alpha\)</span>.</li>
<li>Reject the null hypotheses <span class="math inline">\(H_1, \dots, H_k\)</span>.</li>
</ol>
<p>The obvious question is in choosing the optimal value for <span class="math inline">\(c(m)\)</span>. You can view BH as a special case of BY with <span class="math inline">\(c(m)=1\)</span>. The authors show that the following choice works under any arbitrary dependence assumption:</p>
<p><span class="math display">\[ c(m) = \sum_{i=1}^m \frac{1}{i} \approx log(m) + 0.57721 + \frac{1}{2m}. \]</span></p>
<p>Fascinating. For most applications, this simple procedure provides a credible way of taming the false positives rate. There are improvements to this method, but it feels like we are entering a world in which we get theoretical gains with only limited practical implications.</p>
<p>The main way to improve on BH/BY is to know (or estimate) the share of false hypotheses among the ones we are testing. This, however, goes beyond the scope of the article.</p>
</section>
<section id="knockoffs" class="level4">
<h4 class="anchored" data-anchor-id="knockoffs">Knockoffs</h4>
<p>What if we would like to combine variable selection and control the FDR? BH and BY do not really tell us how to do that. Enter knockoffs. The knockoffs approach is the kid on the block, and it does more than just FDR control.</p>
<p>The idea behind the knockoffs is novel and unrelated to any of the methods I discussed above. Knockoffs are copies of the variables with specific properties. In particular, for each feature/covariate variable <span class="math inline">\(X\)</span>, we create a knockoff copy <span class="math inline">\(\tilde{X}\)</span> such that the correlation structure between any two knockoff variables is the same as between their original counterparts. These knockoffs are constructed without looking at the outcome variable; hence, they are unrelated to it by design. Consequently, we can gauge whether each variable is statistically significant by comparing its test statistic to that of the one for its knockoff copy.</p>
<p>Knockoffs are among the most active fields of research in statistics, with new papers coming out daily (ok, maybe weekly). These methods come in two flavors.</p>
<p>The <a href="https://projecteuclid.org/journals/annals-of-statistics/volume-43/issue-5/Controlling-the-false-discovery-rate-via-knockoffs/10.1214/15-AOS1337.full">fixed-design knockoff filter</a> controls FDR for low-dimensional linear models regardless of the dependency structure of the features. This is great, but it does not work in high dimensions where variable selection is usually most needed.</p>
<p>The <a href="https://rss.onlinelibrary.wiley.com/doi/abs/10.1111/rssb.12265">model-X knockoff filter</a> solves this issue but requires exact knowledge of the joint distribution of the features. This is often infeasible in practice; even estimating that distribution in high dimensions can be really challenging as the curse of dimensionality lays its hammer on the data scientist.</p>
<p>The knockoff idea presents a big step forward because it solves two statistical problems at the same time – selecting among a wide set of predictors and controlling the FDR. I am really excited to see where the current research will take us next.</p>
<p><em>Software Package</em>: <a href="https://cran.r-project.org/web/packages/knockoff/vignettes/knockoff.html">knockoff</a>.</p>
</section>
<section id="other-modern-methods" class="level4">
<h4 class="anchored" data-anchor-id="other-modern-methods">Other Modern Methods</h4>
<p>There is certainly no shortage of statistical methods in this field. Each week, there is at least one new paper dealing with some aspects of FDR or FWER control. Knockoffs, in particular, have gotten a lot of attention recently, with researchers extending the idea to all kinds of settings and models.</p>
<p>I will briefly mention some of the newer methods that have caught my eye in recent months. Many of these control the FDR asymptotically, and some are valid under general dependency structures among the test statistics.</p>
<p>One recent variation of the knockoffs idea uses <a href="https://doi.org/10.1080/01621459.2021.1923510">Gaussian Mirrors</a>; while others rely on subsampling approaches – <a href="https://doi.org/10.1080/01621459.2022.2060113">Data Splitting</a> (based on estimating two independent regression coefficients after splitting the dataset in half) and <a href="https://www.tandfonline.com/doi/full/10.1080/01621459.2021.1945459?src=recsys">Data Aggregation</a>. Clever ideas to improve power include using covariate information to optimally <a href="https://www.nature.com/articles/nmeth.3885">weigh hypotheses</a> in the BH framework or incorporating them into <a href="https://www.tandfonline.com/doi/abs/10.1080/01621459.2014.990973">FDR regressions</a>.</p>
<p>Time will show whether any of these newcomers will come to dominate in practice.</p>
</section>
</section>
</section>
<section id="an-example" class="level2">
<h2 class="anchored" data-anchor-id="an-example">An Example</h2>
<p>I used the popular Titanic dataset (<span class="math inline">\(n=889\)</span>) to illustrate some of the methods I discussed above. Check the Kaggle website carefully for the descriptions of each variable. The outcome/response variable, <code>survived</code>, indicated whether the passenger survived the disaster (mean=<span class="math inline">\(0.382\)</span>), while the predictors included demographic characteristics (e.g., <code>age</code>, <code>gender</code>) as well as some information about the travel ticket (e.g., <code>cabin number</code>, <code>fare</code>).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/multiple-testing.png" class="img-fluid figure-img"></p>
<figcaption>Number of Statistically Significant Variables</figcaption>
</figure>
</div>
<p>Here is a table of the <span class="math inline">\(p\)</span>-values for each feature and various MH adjustments.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 7%">
<col style="width: 16%">
<col style="width: 8%">
<col style="width: 16%">
<col style="width: 17%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Raw</th>
<th>Bonferroni</th>
<th>Holm</th>
<th>Rom.-Wolf</th>
<th>Benj.-Hoch.</th>
<th>Benj.-Yek.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
</tr>
<tr class="even">
<td>age</td>
<td>0.00</td>
<td>0.02</td>
<td>0.01</td>
<td>0.01</td>
<td>0.00</td>
<td>0.01</td>
</tr>
<tr class="odd">
<td>sibsp</td>
<td>0.02</td>
<td>0.34</td>
<td>0.18</td>
<td>0.16</td>
<td>0.04</td>
<td>0.14</td>
</tr>
<tr class="even">
<td>parch</td>
<td>0.32</td>
<td>1.00</td>
<td>1.00</td>
<td>0.77</td>
<td>0.40</td>
<td>1.00</td>
</tr>
<tr class="odd">
<td>fare</td>
<td>0.22</td>
<td>1.00</td>
<td>1.00</td>
<td>0.66</td>
<td>0.30</td>
<td>0.98</td>
</tr>
<tr class="even">
<td>male</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td>embarkedC</td>
<td>0.01</td>
<td>0.23</td>
<td>0.15</td>
<td>0.14</td>
<td>0.04</td>
<td>0.13</td>
</tr>
<tr class="even">
<td>embarkedQ</td>
<td>0.05</td>
<td>0.76</td>
<td>0.35</td>
<td>0.29</td>
<td>0.09</td>
<td>0.28</td>
</tr>
<tr class="odd">
<td>cabinA</td>
<td>0.39</td>
<td>1.00</td>
<td>1.00</td>
<td>0.77</td>
<td>0.42</td>
<td>1.00</td>
</tr>
<tr class="even">
<td>cabinB</td>
<td>0.37</td>
<td>1.00</td>
<td>1.00</td>
<td>0.77</td>
<td>0.42</td>
<td>1.00</td>
</tr>
<tr class="odd">
<td>cabinC</td>
<td>0.92</td>
<td>1.00</td>
<td>1.00</td>
<td>0.92</td>
<td>0.92</td>
<td>1.00</td>
</tr>
<tr class="even">
<td>cabinD</td>
<td>0.06</td>
<td>0.89</td>
<td>0.36</td>
<td>0.29</td>
<td>0.09</td>
<td>0.30</td>
</tr>
<tr class="odd">
<td>cabinE</td>
<td>0.01</td>
<td>0.07</td>
<td>0.05</td>
<td>0.05</td>
<td>0.01</td>
<td>0.05</td>
</tr>
<tr class="even">
<td>cabinF</td>
<td>0.02</td>
<td>0.31</td>
<td>0.18</td>
<td>0.16</td>
<td>0.04</td>
<td>0.14</td>
</tr>
</tbody>
</table>
<p>Eight variables were statistically significant without any MH adjustment. As expected, the FWER adjustments lead to fewer significant variables than the FDR ones. Interestingly, there is a noticeable difference between the two FDR methods – BH and BY, with the latter being more conservative.</p>
<p>You can find the code for this analysis in this GitHub repository.</p>
</section>
<section id="bottom-line" class="level2">
<h2 class="anchored" data-anchor-id="bottom-line">Bottom Line</h2>
<ul>
<li><p>Multiple testing corrections are likely necessary when you are using a single dataset multiple times (i.e., testing multiple hypotheses).</p></li>
<li><p>Two major frameworks exist – FWER and FDR control. The former is often considered too conservative, while the latter is the dominant way researchers and practitioners think about correcting for MH testing.</p></li>
<li><p>In most settings, the Benjamini-Yekuiteli approach offers a great balance between statistical power and technical simplicity.</p></li>
<li><p>Knockoffs are a novel and exciting approach to FDR control.</p></li>
</ul>
</section>
<section id="where-to-learn-more" class="level2">
<h2 class="anchored" data-anchor-id="where-to-learn-more">Where to Learn More</h2>
<p><a href="https://en.wikipedia.org/wiki/False_discovery_rate">Wikipedia</a> is a great resource on the classic approaches to tackling MH issues (both for FDR and FWER control), but it lacks material on modern methodologies. <a href="https://web.stanford.edu/group/candes/knockoffs/">Emmanuel Candès’ website</a> features an accessible introduction to the world of knockoffs. <a href="https://journals.sagepub.com/doi/abs/10.1177/1536867X20976314">Clarke et al.&nbsp;(2020)</a> strip down many technicalities and provide accessible descriptions of both Westfall and Young’s, as well as Romano and Wolf’s methods. <a href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-019-1716-1">Korthauer et al.&nbsp;(2019)</a> compare some of the more recent approaches to controlling the FDR, which are beyond the scope of this blog post.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Barber, R. F., &amp; Candès, E. J. (2015). Controlling the false discovery rate via knockoffs. The Annals of Statistics, 43(5), 2055-2085.</p>
<p>Benjamini, Y., &amp; Yekutieli, D. (2001). The control of the false discovery rate in multiple testing under dependency. Annals of Statistics, 1165-1188.</p>
<p>Benjamini, Y., &amp; Hochberg, Y. (1995). Controlling the false discovery rate: a practical and powerful approach to multiple testing. Journal of the Royal statistical society: series B (Methodological), 57(1), 289-300.</p>
<p>Candes, E., Fan, Y., Janson, L., &amp; Lv, J. (2018). Panning for gold:’model‐X’knockoffs for high dimensional controlled variable selection. Journal of the Royal Statistical Society: Series B (Statistical Methodology), 80(3), 551-577.</p>
<p>Clarke, D., Romano, J. P., &amp; Wolf, M. (2020). The Romano–Wolf multiple-hypothesis correction in Stata. The Stata Journal, 20(4), 812-843.</p>
<p>Dai, C., Lin, B., Xing, X., &amp; Liu, J. S. (2022). False discovery rate control via data splitting. Journal of the American Statistical Association, 1-38.</p>
<p>Korthauer, K., Kimes, P. K., Duvallet, C., Reyes, A., Subramanian, A., Teng, M., … &amp; Hicks, S. C. (2019). A practical guide to methods controlling false discoveries in computational biology. Genome biology, 20(1), 1-21.</p>
<p>Romano, J. P., &amp; Wolf, M. (2005). Stepwise multiple testing as formalized data snooping. Econometrica, 73(4), 1237-1282.</p>
<p>Romano, J. P., &amp; Wolf, M. (2005). Exact and approximate stepdown methods for multiple hypothesis testing. Journal of the American Statistical Association, 100(469), 94-108.</p>
<p>Westfall, P. H., &amp; Young, S. S. (1993). Resampling-based multiple testing: Examples and methods for p-value adjustment (Vol. 279). John Wiley &amp; Sons.</p>
<p>Xing, X., Zhao, Z., &amp; Liu, J. S. (2021). Controlling false discovery rate using gaussian mirrors. Journal of the American Statistical Association, 1-20.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    window.setColorSchemeToggle(window.hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/yourusername\.github\.io\/your-site");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 Vasco Yasenov</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Powered by <a href="https://quarto.org">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>